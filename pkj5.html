<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stellar Showdown - 2 Player Local</title>
    <style>
        :root {
            --p1-color: #00f2ff;
            --p2-color: #ff0055;
            --bg-dark: #050510;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
        }

        /* UI Overlays */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            text-align: center;
        }

        .hidden { display: none !important; }

        h1 { font-size: 2.5rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 4px; }
        p { margin-bottom: 2rem; color: #aaa; }

        button {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: transparent;
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            font-weight: bold;
        }

        button:active {
            transform: scale(0.95);
            background: white;
            color: black;
        }

        /* HUD - Split screen indicators */
        .hud {
            position: absolute;
            width: 100%;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
            z-index: 10;
        }

        .hud-p2 { top: 0; transform: rotate(180deg); color: var(--p2-color); }
        .hud-p1 { bottom: 0; color: var(--p1-color); }

        .stat-box { font-weight: bold; font-size: 1.2rem; }
        .health-bar-bg { width: 100px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; margin-top: 4px; overflow: hidden; }
        .health-bar-fill { height: 100%; transition: width 0.3s; }
        .p1-fill { background: var(--p1-color); box-shadow: 0 0 10px var(--p1-color); }
        .p2-fill { background: var(--p2-color); box-shadow: 0 0 10px var(--p2-color); }

        /* Controls */
        .control-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            display: flex;
            flex-direction: column;
        }

        .player-zone {
            flex: 1;
            position: relative;
            width: 100%;
        }

        /* Control zones for Player 2 (Top, inverted) */
        .p2-zone { transform: rotate(180deg); }

        .shoot-btn {
            position: absolute;
            right: 20px;
            bottom: 40px;
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            pointer-events: auto;
        }

        .shoot-btn:active {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .joystick-area {
            position: absolute;
            left: 20px;
            bottom: 40px;
            width: 120px;
            height: 120px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
            pointer-events: auto;
        }

        .joystick-knob {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        #countdown {
            font-size: 8rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- HUD Player 2 (Top) -->
        <div class="hud hud-p2">
            <div class="stat-box">
                PLAYER 2
                <div class="health-bar-bg"><div id="p2-health" class="health-bar-fill p2-fill" style="width: 100%"></div></div>
            </div>
            <div id="p2-score" class="stat-box">000</div>
        </div>

        <!-- HUD Player 1 (Bottom) -->
        <div class="hud hud-p1">
            <div class="stat-box">
                PLAYER 1
                <div class="health-bar-bg"><div id="p1-health" class="health-bar-fill p1-fill" style="width: 100%"></div></div>
            </div>
            <div id="p1-score" class="stat-box">000</div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <!-- Control Zones -->
        <div class="control-layer">
            <div class="player-zone p2-zone" id="p2-controls">
                <div class="joystick-area" id="p2-joy-area"><div class="joystick-knob" id="p2-joy-knob"></div></div>
                <div class="shoot-btn" id="p2-shoot">FIRE</div>
            </div>
            <div class="player-zone p1-zone" id="p1-controls">
                <div class="joystick-area" id="p1-joy-area"><div class="joystick-knob" id="p1-joy-knob"></div></div>
                <div class="shoot-btn" id="p1-shoot">FIRE</div>
            </div>
        </div>

        <!-- Start Menu -->
        <div id="menu-overlay" class="overlay">
            <h1>STELLAR SHOWDOWN</h1>
            <p>2 Player Local Space Combat</p>
            <button id="start-btn">Start Mission</button>
            <div style="margin-top: 20px; font-size: 0.8rem; color: #666;">Hold phone horizontally for best experience</div>
        </div>

        <!-- Game Over -->
        <div id="over-overlay" class="overlay hidden">
            <h1 id="winner-text">PLAYER 1 WINS</h1>
            <p>The galaxy is yours!</p>
            <button id="restart-btn">Play Again</button>
        </div>

        <!-- Countdown -->
        <div id="countdown-overlay" class="overlay hidden">
            <div id="countdown">3</div>
        </div>
    </div>

    <script>
        // --- GAME ENGINE ---

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        // Game State
        let gameState = 'MENU'; // MENU, COUNTDOWN, PLAYING, GAMEOVER
        let stars = [];
        let particles = [];
        
        const config = {
            playerSpeed: 5,
            bulletSpeed: 8,
            fireRate: 250, // ms
            maxHealth: 100,
            starCount: 100
        };

        class Player {
            constructor(id, color, isTop) {
                this.id = id;
                this.color = color;
                this.isTop = isTop;
                this.width = 40;
                this.height = 40;
                this.reset();
            }

            reset() {
                this.x = width / 2;
                this.y = this.isTop ? 80 : height - 80;
                this.health = config.maxHealth;
                this.score = 0;
                this.lastShot = 0;
                this.bullets = [];
                this.dx = 0;
                this.dy = 0;
            }

            update() {
                this.x += this.dx * config.playerSpeed;
                this.y += this.dy * config.playerSpeed;

                // Bound checking
                this.x = Math.max(this.width, Math.min(width - this.width, this.x));
                
                // Keep players in their halves
                if (this.isTop) {
                    this.y = Math.max(this.height, Math.min(height / 2 - 40, this.y));
                } else {
                    this.y = Math.max(height / 2 + 40, Math.min(height - this.height, this.y));
                }

                // Update Bullets
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    const b = this.bullets[i];
                    b.y += this.isTop ? config.bulletSpeed : -config.bulletSpeed;
                    
                    if (b.y < 0 || b.y > height) {
                        this.bullets.splice(i, 1);
                    }
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                if (this.isTop) ctx.rotate(Math.PI);

                // Draw ship body
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                
                ctx.beginPath();
                ctx.moveTo(0, -20);
                ctx.lineTo(-20, 15);
                ctx.lineTo(0, 5);
                ctx.lineTo(20, 15);
                ctx.closePath();
                ctx.fill();

                // Cockpit
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.beginPath();
                ctx.arc(0, -5, 5, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();

                // Draw Bullets
                ctx.fillStyle = this.color;
                this.bullets.forEach(b => {
                    ctx.beginPath();
                    ctx.arc(b.x, b.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                    // Glow
                    ctx.shadowBlur = 8;
                    ctx.shadowColor = this.color;
                });
            }

            shoot() {
                const now = Date.now();
                if (now - this.lastShot > config.fireRate) {
                    this.bullets.push({ x: this.x, y: this.isTop ? this.y + 20 : this.y - 20 });
                    this.lastShot = now;
                }
            }

            takeDamage(amt) {
                this.health -= amt;
                createExplosion(this.x, this.y, this.color, 10);
                if (this.health <= 0) {
                    this.health = 0;
                    endGame(this.id === 1 ? 2 : 1);
                }
                updateHUD();
            }
        }

        const p1 = new Player(1, '#00f2ff', false);
        const p2 = new Player(2, '#ff0055', true);

        // --- INPUT HANDLING (TOUCH) ---

        function setupControls(playerId, joyAreaId, joyKnobId, shootBtnId) {
            const player = playerId === 1 ? p1 : p2;
            const area = document.getElementById(joyAreaId);
            const knob = document.getElementById(joyKnobId);
            const shoot = document.getElementById(shootBtnId);

            let touchId = null;

            area.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchId = e.changedTouches[0].identifier;
            }, {passive: false});

            window.addEventListener('touchmove', (e) => {
                if (touchId === null) return;
                
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === touchId) {
                        const rect = area.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        
                        let dx = touch.clientX - centerX;
                        let dy = touch.clientY - centerY;
                        
                        // Invert controls for Player 2 because their zone is rotated
                        if (player.isTop) {
                            dx *= -1;
                            dy *= -1;
                        }

                        const dist = Math.sqrt(dx*dx + dy*dy);
                        const maxDist = rect.width / 2;
                        
                        if (dist > maxDist) {
                            dx *= maxDist / dist;
                            dy *= maxDist / dist;
                        }

                        // Normalize for movement
                        player.dx = dx / maxDist;
                        player.dy = dy / maxDist;

                        // Visual knob feedback
                        knob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
                    }
                }
            }, {passive: false});

            window.addEventListener('touchend', (e) => {
                for (let i = 0; i < e.changedTouches.length; i++) {
                    if (e.changedTouches[i].identifier === touchId) {
                        touchId = null;
                        player.dx = 0;
                        player.dy = 0;
                        knob.style.transform = `translate(-50%, -50%)`;
                    }
                }
            });

            // Shooting
            let isShooting = false;
            shoot.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isShooting = true;
            });
            shoot.addEventListener('touchend', () => {
                isShooting = false;
            });

            // Loop for rapid fire
            setInterval(() => {
                if (isShooting && gameState === 'PLAYING') player.shoot();
            }, 50);
        }

        setupControls(1, 'p1-joy-area', 'p1-joy-knob', 'p1-shoot');
        setupControls(2, 'p2-joy-area', 'p2-joy-knob', 'p2-shoot');

        // --- EFFECTS ---

        function initStars() {
            stars = [];
            for (let i = 0; i < config.starCount; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    size: Math.random() * 2,
                    speed: 0.5 + Math.random() * 2
                });
            }
        }

        function createExplosion(x, y, color, count = 20) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x, y,
                    dx: (Math.random() - 0.5) * 10,
                    dy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    decay: 0.02 + Math.random() * 0.03,
                    color,
                    size: 2 + Math.random() * 3
                });
            }
        }

        // --- GAME LOGIC ---

        function update() {
            if (gameState !== 'PLAYING') return;

            p1.update();
            p2.update();

            // Background movement
            stars.forEach(s => {
                s.y += s.speed;
                if (s.y > height) s.y = 0;
            });

            // Collision Detection (P1 bullets vs P2)
            for (let i = p1.bullets.length - 1; i >= 0; i--) {
                const b = p1.bullets[i];
                const dist = Math.hypot(b.x - p2.x, b.y - p2.y);
                if (dist < 30) {
                    p2.takeDamage(10);
                    p1.score += 50;
                    p1.bullets.splice(i, 1);
                }
            }

            // Collision Detection (P2 bullets vs P1)
            for (let i = p2.bullets.length - 1; i >= 0; i--) {
                const b = p2.bullets[i];
                const dist = Math.hypot(b.x - p1.x, b.y - p1.y);
                if (dist < 30) {
                    p1.takeDamage(10);
                    p2.score += 50;
                    p2.bullets.splice(i, 1);
                }
            }

            // Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.dx;
                p.y += p.dy;
                p.life -= p.decay;
                if (p.life <= 0) particles.splice(i, 1);
            }

            updateHUD();
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            // Draw Stars
            ctx.fillStyle = 'white';
            stars.forEach(s => {
                ctx.globalAlpha = s.speed / 3;
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1.0;

            // Split line
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
            ctx.setLineDash([]);

            if (gameState === 'PLAYING' || gameState === 'COUNTDOWN') {
                p1.draw();
                p2.draw();
            }

            // Draw Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1.0;

            requestAnimationFrame(() => {
                update();
                draw();
            });
        }

        function updateHUD() {
            document.getElementById('p1-health').style.width = p1.health + '%';
            document.getElementById('p2-health').style.width = p2.health + '%';
            document.getElementById('p1-score').innerText = p1.score.toString().padStart(3, '0');
            document.getElementById('p2-score').innerText = p2.score.toString().padStart(3, '0');
        }

        function startGame() {
            document.getElementById('menu-overlay').classList.add('hidden');
            document.getElementById('over-overlay').classList.add('hidden');
            document.getElementById('countdown-overlay').classList.remove('hidden');
            
            p1.reset();
            p2.reset();
            particles = [];
            initStars();
            
            gameState = 'COUNTDOWN';
            let count = 3;
            const countEl = document.getElementById('countdown');
            countEl.innerText = count;

            const timer = setInterval(() => {
                count--;
                if (count <= 0) {
                    clearInterval(timer);
                    document.getElementById('countdown-overlay').classList.add('hidden');
                    gameState = 'PLAYING';
                } else {
                    countEl.innerText = count;
                }
            }, 1000);
        }

        function endGame(winnerId) {
            gameState = 'GAMEOVER';
            document.getElementById('over-overlay').classList.remove('hidden');
            document.getElementById('winner-text').innerText = `PLAYER ${winnerId} WINS`;
            document.getElementById('winner-text').style.color = winnerId === 1 ? 'var(--p1-color)' : 'var(--p2-color)';
            
            createExplosion(width/2, height/2, winnerId === 1 ? p1.color : p2.color, 100);
        }

        // --- INIT ---

        document.getElementById('start-btn').addEventListener('click', startGame);
        document.getElementById('restart-btn').addEventListener('click', startGame);

        window.onload = () => {
            initStars();
            draw();
        };

    </script>
</body>
</html>